# Test Center - Compliance Testing Application (Metadata Service)
# Copyright (C) 2012-2014 Paulo Ferreira <pf at sourcenotes.org>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

##
# Run Entity Forms (Metadata Model)
##
play:
  #
  # Play Entry Form
  #
  playentry:
    inherit: default
    title: Play Entry
    layout:
      - information
      - description
    services:
      read: 'play:current'
    widgets:
      information:
        type: group
        label: Information
        layout: ['playentry:sequence', 'playentry:run\run:name', 'playentry:test\test:name', 'playentry:step\step:name']
      description:
        type: group
        label: Description
        layout: ['playentry:step\step:description']
    
  #
  # Player Form
  #
  player:
    inherit: default
    title: Play
    layout:
      - player
      - entry
      - states
    services:
      read: 'play:current'
    widgets:
      player:
        type: toolbar
        buttons: 
          - 'widgets\previous'
          - 'widgets\pause'
          - 'widgets\stop'
          - 'widgets\next'
      entry: 
        type: form
        form: 'play:playentry'
        overlay: 
          title: Details
      states:
        type: toolbar
        buttons: 
          - 'widgets\fail'
          - 'widgets\pass'
      previous:
        type: button 
        Label: Previous
        icon: previous.png
        click:
          synchronous: true
          action: 
            - 'service\play:previous'
            - 'event\reload'
        shift:
          synchronous: true
          action: 
            - 'service\play:test_previous'
            - 'event\reload'
        exception: 'Unable to Rewind'
      pause:
        type: button
        Label: Pause
        icon: pause.png
        click:
          - 'event\close'
      stop:
        type: button
        Label: Stop
        icon: stop.png
        click:
          synchronous: true
          actions:
            - 'service\run:set_state({playentry:run\run:id},0,0)': 'Failed to Set Run State'
            - 'service\run:close'
            - 'event\close'
        shift:
          synchronous: true
          actions:
            - 'form\run:close({playentry:run\run:id})'
            - 'event\close'
        exception: 'Failed to Close Run'
      next:
        type: button
        Label: Next
        icon: next.png
        click:
          synchronous: true
          action: 
            - 'service\play:next'
            - 'event\reload'
        shift:
          synchronous: true
          action:  
            - 'service\play:test_next'
            - 'event\reload'
        exception: 'Unable to Move Forward'
      pass:
        type: button
        Label: Pass
        icon: check.png
        click:
          synchronous: true
          actions:
            - 'service\play:set_state(0)' : 'Unable to Modify Step State'
            - 'service\play:next'          : 'Unable to Move Forward'
            - 'event\reload'
        shift:
          synchronous: true
          actions:
            - 'form\play:step_state({playentry})'
            - 'event\reload'
      fail:
        type: button
        Label: Fail
        icon: cross.png
        click:
          synchronous: true
          actions:
            - 'service\play:set_state(1)' : 'Unable to Modify Step State'
            - 'service\play:next'          : 'Unable to Move Forward'
            - 'event\reload'
        shift:
          synchronous: true
          actions:
            - 'form\play:step_state'
            - 'event\reload'
  #
  # Set Step State
  #
  step_state:
    inherit: default
    title: Step State
    layout:
      - information
      - state
      - comment
    field_map:
      - 'playentry:state' : 'state:state'
      - 'playentry:state_code' : 'statecode:code'
    services:
      read: 'play:get_state'
      update: 'play:set_state'
    widgets:
      information:
        type: group
        label: Information
        layout: ['playentry:sequence', 'playentry:run\run:name', 'playentry:test\test:name', 'playentry:step\step:name']
      state:
        type: group
        label: State
        layout: ['list\steps:state','list\steps:codes']
      comment:
        type: group
        label: Comment
        layout: ['playentry:comment']
